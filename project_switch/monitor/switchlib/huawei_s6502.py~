#!/usr/bin/env python3

import re, sys
import decorator

# function "get_oid" and "walk_oid" has been import dynamicly by class.py
@decorator.rrd_options(DS=('memory_1_uility', 'memory_2_uility'))
def memory(get_oid):
    total = int(re.search('Gauge32: (.*)\n', get_oid('1.3.6.1.4.1.2011.6.1.2.1.1.2.0')).group(1))
    free = int(re.search('Gauge32: (.*)\n', get_oid('1.3.6.1.4.1.2011.6.1.2.1.1.3.0')).group(1))
    r1 = round((total-free)/total*100)
    total = int(re.search('Gauge32: (.*)\n', get_oid('1.3.6.1.4.1.2011.6.1.2.1.1.2.1')).group(1))
    free = int(re.search('Gauge32: (.*)\n', get_oid('1.3.6.1.4.1.2011.6.1.2.1.1.3.1')).group(1))
    r2 = round((total-free)/total*100)
    return (r1, r2)

@decorator.rrd_options(DS=('CPU_1_uility', 'CPU_2_uility'))
def cpu(get_oid):
    r1 = int(re.search('Gauge32: (.*)\n', get_oid('1.3.6.1.4.1.2011.6.1.1.1.2.0')).group(1))
    r2 = int(re.search('Gauge32: (.*)\n', get_oid('1.3.6.1.4.1.2011.6.1.1.1.2.1')).group(1))
    return (r1, r2)
